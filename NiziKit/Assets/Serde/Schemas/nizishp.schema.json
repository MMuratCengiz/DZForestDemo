{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://nizikit.dev/schemas/nizishp.schema.json",
  "title": "NiziKit Shader Program",
  "type": "object",
  "required": ["name", "stages"],
  "properties": {
    "name": {
      "type": "string"
    },
    "type": {
      "type": "string",
      "enum": ["graphics", "compute", "rayTracing", "mesh"]
    },
    "stages": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/shaderStage"
      }
    },
    "defines": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      }
    },
    "rayTracing": {
      "$ref": "#/$defs/shaderRayTracingDesc"
    },
    "pipeline": {
      "$ref": "#/$defs/graphicsPipeline"
    },
    "computePipeline": {
      "$ref": "#/$defs/computePipeline"
    },
    "rayTracingPipeline": {
      "$ref": "#/$defs/rayTracingPipeline"
    },
    "meshPipeline": {
      "$ref": "#/$defs/meshPipeline"
    }
  },
  "$defs": {
    "shaderStage": {
      "type": "object",
      "required": ["stage", "path"],
      "properties": {
        "stage": {
          "type": "string",
          "enum": ["vertex", "pixel", "geometry", "hull", "domain", "compute", "rayGen", "anyHit", "closestHit", "miss", "intersection", "callable", "task", "mesh"]
        },
        "path": {
          "type": "string"
        },
        "entryPoint": {
          "type": "string",
          "default": "main"
        },
        "defines": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "rayTracing": {
          "$ref": "#/$defs/rayTracingShaderDesc"
        },
        "bindless": {
          "$ref": "#/$defs/bindlessDesc"
        },
        "threadGroup": {
          "$ref": "#/$defs/threadGroup"
        }
      }
    },
    "threadGroup": {
      "type": "object",
      "properties": {
        "x": { "type": "integer", "default": 1, "minimum": 1 },
        "y": { "type": "integer", "default": 1, "minimum": 1 },
        "z": { "type": "integer", "default": 1, "minimum": 1 }
      }
    },
    "bindlessDesc": {
      "type": "object",
      "properties": {
        "bindlessArrays": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/bindlessSlot"
          }
        }
      }
    },
    "bindlessSlot": {
      "type": "object",
      "properties": {
        "descriptor": {
          "type": "string",
          "enum": ["none", "buffer", "rwBuffer", "texture", "rwTexture", "renderTarget", "depthStencil", "sampler", "uniformBuffer", "rootConstant", "indexBuffer", "vertexBuffer", "indirectBuffer", "textureCube", "accelerationStructure", "structuredBuffer", "rawBuffer"]
        },
        "binding": { "type": "integer", "minimum": 0 },
        "registerSpace": { "type": "integer", "minimum": 0 },
        "maxArraySize": { "type": "integer", "minimum": 1 }
      }
    },
    "rayTracingShaderDesc": {
      "type": "object",
      "properties": {
        "hitGroupType": {
          "type": "string",
          "enum": ["triangles", "aabbs"],
          "default": "triangles"
        },
        "localBindings": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/resourceBindingSlot"
          }
        }
      }
    },
    "resourceBindingSlot": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["constantBuffer", "shaderResource", "unorderedAccess", "sampler"]
        },
        "binding": { "type": "integer", "minimum": 0 },
        "registerSpace": { "type": "integer", "minimum": 0 }
      }
    },
    "shaderRayTracingDesc": {
      "type": "object",
      "properties": {
        "maxPayloadBytes": { "type": "integer", "default": 32, "minimum": 0 },
        "maxAttributeBytes": { "type": "integer", "default": 8, "minimum": 0 },
        "maxRecursionDepth": { "type": "integer", "default": 1, "minimum": 1 }
      }
    },
    "hitGroupDesc": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "type": "string" },
        "intersectionShaderIndex": { "type": "integer", "default": -1 },
        "anyHitShaderIndex": { "type": "integer", "default": -1 },
        "closestHitShaderIndex": { "type": "integer", "default": -1 },
        "localRootSignatureIndex": { "type": "integer", "default": -1 },
        "type": {
          "type": "string",
          "enum": ["triangles", "aabbs"],
          "default": "triangles"
        }
      }
    },
    "graphicsPipeline": {
      "type": "object",
      "properties": {
        "primitiveTopology": {
          "type": "string",
          "enum": ["triangle", "line", "point", "patch"],
          "default": "triangle"
        },
        "cullMode": {
          "type": "string",
          "enum": ["none", "frontFace", "backFace"],
          "default": "backFace"
        },
        "fillMode": {
          "type": "string",
          "enum": ["solid", "wireframe"],
          "default": "solid"
        },
        "depthTest": { "$ref": "#/$defs/depthTest" },
        "stencilTest": { "$ref": "#/$defs/stencilTest" },
        "blend": { "$ref": "#/$defs/blend" },
        "renderTargets": {
          "type": "array",
          "items": { "$ref": "#/$defs/renderTarget" }
        },
        "rasterization": { "$ref": "#/$defs/rasterization" },
        "alphaToCoverageEnable": { "type": "boolean", "default": false },
        "independentBlendEnable": { "type": "boolean", "default": false },
        "blendLogicOpEnable": { "type": "boolean", "default": false },
        "blendLogicOp": {
          "type": "string",
          "enum": ["clear", "set", "copy", "copyInverted", "noOp", "invert", "and", "nand", "or", "nor", "xor", "equiv", "andReverse", "andInverted", "orReverse", "orInverted"],
          "default": "noOp"
        },
        "msaaSampleCount": {
          "type": "string",
          "enum": ["none", "x1", "x2", "x4", "x8", "x16", "x32", "x64"],
          "default": "none"
        },
        "depthStencilFormat": { "type": "string" }
      }
    },
    "computePipeline": {
      "type": "object",
      "properties": {
        "threadGroup": { "$ref": "#/$defs/threadGroup" }
      }
    },
    "rayTracingPipeline": {
      "type": "object",
      "properties": {
        "hitGroups": {
          "type": "array",
          "items": { "$ref": "#/$defs/hitGroupDesc" }
        },
        "maxPayloadBytes": { "type": "integer", "default": 32, "minimum": 0 },
        "maxAttributeBytes": { "type": "integer", "default": 8, "minimum": 0 },
        "maxRecursionDepth": { "type": "integer", "default": 1, "minimum": 1 }
      }
    },
    "meshPipeline": {
      "type": "object",
      "properties": {
        "primitiveTopology": {
          "type": "string",
          "enum": ["triangle", "line", "point"],
          "default": "triangle"
        },
        "cullMode": {
          "type": "string",
          "enum": ["none", "frontFace", "backFace"],
          "default": "backFace"
        },
        "fillMode": {
          "type": "string",
          "enum": ["solid", "wireframe"],
          "default": "solid"
        },
        "depthTest": { "$ref": "#/$defs/depthTest" },
        "stencilTest": { "$ref": "#/$defs/stencilTest" },
        "blend": { "$ref": "#/$defs/blend" },
        "renderTargets": {
          "type": "array",
          "items": { "$ref": "#/$defs/renderTarget" }
        },
        "rasterization": { "$ref": "#/$defs/rasterization" },
        "msaaSampleCount": {
          "type": "string",
          "enum": ["none", "x1", "x2", "x4", "x8", "x16", "x32", "x64"],
          "default": "none"
        },
        "depthStencilFormat": { "type": "string" }
      }
    },
    "depthTest": {
      "type": "object",
      "properties": {
        "enable": { "type": "boolean", "default": true },
        "compareOp": {
          "type": "string",
          "enum": ["never", "less", "equal", "lessOrEqual", "greater", "notEqual", "greaterOrEqual", "always"],
          "default": "less"
        },
        "write": { "type": "boolean", "default": true }
      }
    },
    "stencilTest": {
      "type": "object",
      "properties": {
        "enable": { "type": "boolean", "default": false },
        "writeMask": { "type": "integer", "default": 255, "minimum": 0, "maximum": 255 },
        "readMask": { "type": "integer", "default": 255, "minimum": 0, "maximum": 255 },
        "frontFace": { "$ref": "#/$defs/stencilFace" },
        "backFace": { "$ref": "#/$defs/stencilFace" }
      }
    },
    "stencilFace": {
      "type": "object",
      "properties": {
        "compareOp": {
          "type": "string",
          "enum": ["never", "less", "equal", "lessOrEqual", "greater", "notEqual", "greaterOrEqual", "always"],
          "default": "always"
        },
        "failOp": {
          "type": "string",
          "enum": ["keep", "zero", "replace", "incrementAndClamp", "decrementAndClamp", "invert", "incrementAndWrap", "decrementAndWrap"],
          "default": "keep"
        },
        "passOp": {
          "type": "string",
          "enum": ["keep", "zero", "replace", "incrementAndClamp", "decrementAndClamp", "invert", "incrementAndWrap", "decrementAndWrap"],
          "default": "keep"
        },
        "depthFailOp": {
          "type": "string",
          "enum": ["keep", "zero", "replace", "incrementAndClamp", "decrementAndClamp", "invert", "incrementAndWrap", "decrementAndWrap"],
          "default": "keep"
        }
      }
    },
    "blend": {
      "type": "object",
      "properties": {
        "enable": { "type": "boolean", "default": false },
        "srcBlend": {
          "type": "string",
          "enum": ["zero", "one", "srcColor", "invSrcColor", "srcAlpha", "invSrcAlpha", "dstAlpha", "invDstAlpha", "dstColor", "invDstColor", "srcAlphaSaturate", "blendFactor", "invBlendFactor", "src1Color", "invSrc1Color", "src1Alpha", "invSrc1Alpha"],
          "default": "srcAlpha"
        },
        "dstBlend": {
          "type": "string",
          "enum": ["zero", "one", "srcColor", "invSrcColor", "srcAlpha", "invSrcAlpha", "dstAlpha", "invDstAlpha", "dstColor", "invDstColor", "srcAlphaSaturate", "blendFactor", "invBlendFactor", "src1Color", "invSrc1Color", "src1Alpha", "invSrc1Alpha"],
          "default": "invSrcAlpha"
        },
        "blendOp": {
          "type": "string",
          "enum": ["add", "subtract", "reverseSubtract", "min", "max"],
          "default": "add"
        },
        "srcBlendAlpha": {
          "type": "string",
          "enum": ["zero", "one", "srcColor", "invSrcColor", "srcAlpha", "invSrcAlpha", "dstAlpha", "invDstAlpha", "dstColor", "invDstColor", "srcAlphaSaturate", "blendFactor", "invBlendFactor", "src1Color", "invSrc1Color", "src1Alpha", "invSrc1Alpha"],
          "default": "one"
        },
        "dstBlendAlpha": {
          "type": "string",
          "enum": ["zero", "one", "srcColor", "invSrcColor", "srcAlpha", "invSrcAlpha", "dstAlpha", "invDstAlpha", "dstColor", "invDstColor", "srcAlphaSaturate", "blendFactor", "invBlendFactor", "src1Color", "invSrc1Color", "src1Alpha", "invSrc1Alpha"],
          "default": "invSrcAlpha"
        },
        "blendOpAlpha": {
          "type": "string",
          "enum": ["add", "subtract", "reverseSubtract", "min", "max"],
          "default": "add"
        },
        "renderTargetWriteMask": { "type": "integer", "default": 15, "minimum": 0, "maximum": 15 }
      }
    },
    "renderTarget": {
      "type": "object",
      "properties": {
        "format": { "type": "string" },
        "blend": { "$ref": "#/$defs/blend" }
      }
    },
    "rasterization": {
      "type": "object",
      "properties": {
        "depthBias": { "type": "integer", "default": 0 },
        "depthBiasClamp": { "type": "number", "default": 0.0 },
        "slopeScaledDepthBias": { "type": "number", "default": 0.0 },
        "frontCounterClockwise": { "type": "boolean", "default": false }
      }
    }
  }
}
