<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <NiziKitAssetsDir Condition="'$(NiziKitAssetsDir)' == ''">$(ProjectDir)Assets</NiziKitAssetsDir>
    <_IsBlazorWasm Condition="'$(UsingMicrosoftNETSdkBlazorWebAssembly)' == 'true'">true</_IsBlazorWasm>
    <GenerateNiziKitManifest Condition="'$(GenerateNiziKitManifest)' == ''">true</GenerateNiziKitManifest>
  </PropertyGroup>

  <!-- Desktop: Copy to output directory -->
  <ItemGroup Condition="Exists('$(NiziKitAssetsDir)') AND '$(_IsBlazorWasm)' != 'true'">
    <Content Include="$(NiziKitAssetsDir)\**\*" Exclude="$(NiziKitAssetsDir)\**\.gitkeep;$(NiziKitAssetsDir)\**\.niziassets">
      <Link>Assets\%(RecursiveDir)%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <!-- Blazor WASM: Copy to wwwroot -->
  <ItemGroup Condition="Exists('$(NiziKitAssetsDir)') AND '$(_IsBlazorWasm)' == 'true'">
    <Content Include="$(NiziKitAssetsDir)\**\*" Exclude="$(NiziKitAssetsDir)\**\.gitkeep;$(NiziKitAssetsDir)\**\.niziassets">
      <Link>wwwroot\Assets\%(RecursiveDir)%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <!-- Generate manifest.json when enabled -->
  <Target Name="GenerateNiziManifest" AfterTargets="Build"
          Condition="'$(GenerateNiziKitManifest)' == 'true' AND Exists('$(NiziKitAssetsDir)')">
    <PropertyGroup>
      <_NiziKitBuildProject>$(MSBuildThisFileDirectory)..\..\NiziKit.Build\NiziKit.Build.csproj</_NiziKitBuildProject>
    </PropertyGroup>
    <Exec Command="dotnet run --project &quot;$(_NiziKitBuildProject)&quot; -- generate-manifest &quot;$(NiziKitAssetsDir)&quot; &quot;$(NiziKitAssetsDir)&quot;" />
  </Target>

</Project>
