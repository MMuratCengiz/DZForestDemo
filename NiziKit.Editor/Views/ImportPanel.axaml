<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="NiziKit.Editor.Views.ImportPanel"
             x:DataType="vm:ImportViewModel">

    <Grid RowDefinitions="*,Auto,Auto" Margin="16">
        <!-- Source Browser -->
        <Border Grid.Row="0"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="{DynamicResource ControlCornerRadius}"
                Padding="12"
                Margin="0,0,0,12">
            <views:FileBrowserGrid DataContext="{Binding FileBrowser}"/>
        </Border>

        <!-- Import Options -->
        <Border Grid.Row="1"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="{DynamicResource ControlCornerRadius}"
                Padding="16,12"
                Margin="0,0,0,12">
            <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,*" RowDefinitions="Auto">
                <!-- Type Selection -->
                <TextBlock Text="Type"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"/>
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="16"
                            Margin="0,0,24,0">
                    <RadioButton Content="Models"
                                 IsChecked="{Binding ImportType, Converter={x:Static vm:ImportTypeConverter.Instance}, ConverterParameter={x:Static vm:ImportType.Models}}"
                                 GroupName="ImportType"/>
                    <RadioButton Content="Textures"
                                 IsChecked="{Binding ImportType, Converter={x:Static vm:ImportTypeConverter.Instance}, ConverterParameter={x:Static vm:ImportType.Textures}}"
                                 GroupName="ImportType"/>
                    <RadioButton Content="Both"
                                 IsChecked="{Binding ImportType, Converter={x:Static vm:ImportTypeConverter.Instance}, ConverterParameter={x:Static vm:ImportType.Both}}"
                                 GroupName="ImportType"/>
                </StackPanel>

                <!-- Scale -->
                <TextBlock Grid.Column="2"
                           Text="Scale"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"/>
                <TextBox Grid.Column="3"
                         Text="{Binding ModelScale}"
                         Width="80"
                         Margin="0,0,24,0"/>

                <!-- Mips -->
                <CheckBox Grid.Column="4"
                          Content="Generate Mipmaps"
                          IsChecked="{Binding GenerateMips}"
                          VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Action Bar with Output -->
        <Border Grid.Row="2"
                Background="{DynamicResource LayerFillColorDefaultBrush}"
                CornerRadius="{DynamicResource ControlCornerRadius}"
                Padding="16,12">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                <!-- Output Directory -->
                <TextBlock Text="Output"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"/>
                <TextBox Grid.Column="1"
                         Text="{Binding OutputDirectory}"
                         Watermark="Assets/..."
                         VerticalAlignment="Center"/>

                <!-- Progress -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Margin="16,0"
                            IsVisible="{Binding IsImporting}">
                    <TextBlock Text="{Binding ProgressText}"
                               VerticalAlignment="Center"
                               MaxWidth="200"
                               TextTrimming="CharacterEllipsis"/>
                    <ProgressBar Value="{Binding Progress}"
                                 Maximum="100"
                                 Width="100"
                                 Height="4"
                                 VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Buttons -->
                <Button Grid.Column="3"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Margin="12,0"
                        MinWidth="100"
                        Padding="16,10"/>
                <Button Grid.Column="4"
                        Content="Import"
                        Command="{Binding ImportCommand}"
                        IsEnabled="{Binding !IsImporting}"
                        MinWidth="100"
                        Padding="16,10"
                        Classes="accent"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
