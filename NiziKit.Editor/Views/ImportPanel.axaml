<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="NiziKit.Editor.Views.ImportPanel"
             x:DataType="vm:ImportViewModel">

    <Grid RowDefinitions="*,Auto,Auto" Margin="24">
        <!-- Source Browser -->
        <Border Grid.Row="0"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="{DynamicResource ControlCornerRadius}"
                Padding="16"
                Margin="0,0,0,16">
            <Grid RowDefinitions="Auto,*">
                <TextBlock Grid.Row="0"
                           Text="Source Files"
                           Theme="{StaticResource BodyStrongTextBlockStyle}"
                           Margin="0,0,0,12"/>
                <views:FileBrowserGrid Grid.Row="1"
                                       DataContext="{Binding FileBrowser}"/>
            </Grid>
        </Border>

        <!-- Import Options -->
        <Border Grid.Row="1"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="{DynamicResource ControlCornerRadius}"
                Padding="20"
                Margin="0,0,0,16">
            <StackPanel Spacing="16">
                <TextBlock Text="Import Options"
                           Theme="{StaticResource BodyStrongTextBlockStyle}"/>

                <StackPanel Spacing="14">
                    <!-- Type Selection -->
                    <Grid ColumnDefinitions="80,*">
                        <TextBlock Text="Type"
                                   VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    Spacing="24">
                            <RadioButton Content="Models"
                                         IsChecked="{Binding ImportType, Converter={x:Static vm:ImportTypeConverter.Instance}, ConverterParameter={x:Static vm:ImportType.Models}}"
                                         GroupName="ImportType"/>
                            <RadioButton Content="Textures"
                                         IsChecked="{Binding ImportType, Converter={x:Static vm:ImportTypeConverter.Instance}, ConverterParameter={x:Static vm:ImportType.Textures}}"
                                         GroupName="ImportType"/>
                            <RadioButton Content="Both"
                                         IsChecked="{Binding ImportType, Converter={x:Static vm:ImportTypeConverter.Instance}, ConverterParameter={x:Static vm:ImportType.Both}}"
                                         GroupName="ImportType"/>
                        </StackPanel>
                    </Grid>

                    <!-- Scale and Mips -->
                    <Grid ColumnDefinitions="80,Auto,*">
                        <TextBlock Text="Scale"
                                   VerticalAlignment="Center"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding ModelScale}"
                                 Width="100"/>
                        <CheckBox Grid.Column="2"
                                  Content="Generate Mipmaps"
                                  IsChecked="{Binding GenerateMips}"
                                  Margin="24,0,0,0"
                                  VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Output Directory -->
                    <Grid ColumnDefinitions="80,*">
                        <TextBlock Text="Output"
                                   VerticalAlignment="Center"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding OutputDirectory}"
                                 Watermark="Assets/..."/>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Action Bar -->
        <Border Grid.Row="2"
                Background="{DynamicResource LayerFillColorDefaultBrush}"
                CornerRadius="{DynamicResource ControlCornerRadius}"
                Padding="16">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <!-- Progress -->
                <StackPanel Grid.Column="0"
                            VerticalAlignment="Center"
                            Spacing="6"
                            IsVisible="{Binding IsImporting}">
                    <TextBlock Text="{Binding ProgressText}"/>
                    <ProgressBar Value="{Binding Progress}"
                                 Maximum="100"
                                 Height="4"/>
                </StackPanel>

                <!-- Buttons -->
                <Button Grid.Column="1"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Margin="0,0,12,0"
                        MinWidth="120"
                        Padding="20,12"/>
                <Button Grid.Column="2"
                        Content="Import"
                        Command="{Binding ImportCommand}"
                        IsEnabled="{Binding !IsImporting}"
                        MinWidth="120"
                        Padding="20,12"
                        Classes="accent"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
