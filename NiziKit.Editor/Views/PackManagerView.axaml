<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="NiziKit.Editor.Views.PackManagerView"
             x:DataType="vm:PackManagerViewModel">

    <Panel>
    <Grid ColumnDefinitions="200,*">
        <Border Grid.Column="0"
                Background="{StaticResource EditorPanelSecondaryBackground}"
                BorderBrush="{StaticResource EditorPanelBorder}"
                BorderThickness="0,0,1,0"
                Padding="10">
            <Grid RowDefinitions="Auto,*,Auto">
                <TextBlock Grid.Row="0"
                           Text="Packs"
                           Classes="subtitle"
                           Margin="4,0,0,12"/>

                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Packs}"
                         SelectedItem="{Binding SelectedPack}"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="vm:PackInfo">
                            <Border Padding="8,6"
                                    Background="Transparent">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="{Binding Name}"
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Version}"
                                               Foreground="{StaticResource EditorTextMuted}"
                                               FontSize="{StaticResource FontSizeCaption}"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            Spacing="6"
                            Margin="0,12,0,0">
                    <Button Content="New"
                            Command="{Binding NewPackCommand}"
                            Padding="14,8"
                            Classes="accent"/>
                    <Button Command="{Binding RefreshPacksCommand}"
                            Padding="10,8">
                        <ui:SymbolIcon Symbol="Refresh" FontSize="{StaticResource IconSizeBase}"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Column="1" RowDefinitions="Auto,*,Auto" IsVisible="{Binding IsEditing}">
            <Border Grid.Row="0"
                    Background="{StaticResource EditorPanelSecondaryBackground}"
                    Padding="14,10"
                    Margin="0,0,0,4">
                <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                    <TextBox Grid.Column="0"
                             Text="{Binding PackName}"
                             Watermark="Pack Name"
                             MinWidth="220"/>

                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Spacing="8"
                                VerticalAlignment="Center">
                        <TextBlock Text="v"
                                   Foreground="{StaticResource EditorTextMuted}"
                                   VerticalAlignment="Center"/>
                        <TextBox Text="{Binding PackVersion}"
                                 Watermark="1.0.0"
                                 Width="110"/>
                    </StackPanel>

                    <Button Grid.Column="4"
                            Content="Save"
                            Command="{Binding SavePackCommand}"
                            Padding="22,10"
                            Margin="14,0,0,0"
                            Classes="accent"/>
                </Grid>
            </Border>

            <TabControl Grid.Row="1"
                        SelectedIndex="{Binding SelectedTabIndex}">

                <TabItem Header="Textures">
                    <Grid RowDefinitions="*,Auto">
                        <ScrollViewer Grid.Row="0"
                                      HorizontalScrollBarVisibility="Disabled"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding Textures}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:PackAssetEntry">
                                        <Border Classes="content-tile">
                                            <Grid RowDefinitions="*,Auto,Auto">
                                                <ui:SymbolIcon Grid.Row="0"
                                                               Symbol="Image"
                                                               FontSize="{StaticResource IconSizeXL}"
                                                               Foreground="{StaticResource EditorTextSecondary}"
                                                               VerticalAlignment="Center"
                                                               HorizontalAlignment="Center"/>
                                                <TextBlock Grid.Row="1"
                                                           Text="{Binding Key}"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextAlignment="Center"
                                                           ToolTip.Tip="{Binding Key}"
                                                           Margin="0,8,0,0"/>
                                                <Button Grid.Row="2"
                                                        Content="Remove"
                                                        Padding="10,6"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,6,0,0"
                                                        Command="{Binding $parent[ItemsControl].DataContext.RemoveTextureCommand}"
                                                        CommandParameter="{Binding}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    Spacing="10"
                                    Margin="12">
                            <Button Content="+ Add Texture"
                                    Command="{Binding BrowseTextureCommand}"
                                    Padding="14,8"
                                    Classes="accent"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Materials">
                    <Grid RowDefinitions="*,Auto">
                        <ScrollViewer Grid.Row="0"
                                      HorizontalScrollBarVisibility="Disabled"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding Materials}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:PackAssetEntry">
                                        <Border Classes="content-tile"
                                                DoubleTapped="OnAssetCardDoubleTapped"
                                                Tag="{Binding}">
                                            <Grid RowDefinitions="*,Auto,Auto">
                                                <ui:SymbolIcon Grid.Row="0"
                                                               Symbol="Globe"
                                                               FontSize="{StaticResource IconSizeXL}"
                                                               Foreground="{StaticResource EditorTextSecondary}"
                                                               VerticalAlignment="Center"
                                                               HorizontalAlignment="Center"/>
                                                <TextBlock Grid.Row="1"
                                                           Text="{Binding Key}"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextAlignment="Center"
                                                           ToolTip.Tip="{Binding Key}"
                                                           Margin="0,8,0,0"/>
                                                <Button Grid.Row="2"
                                                        Content="Remove"
                                                        Padding="10,6"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,6,0,0"
                                                        Command="{Binding $parent[ItemsControl].DataContext.RemoveMaterialCommand}"
                                                        CommandParameter="{Binding}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    Spacing="10"
                                    Margin="12">
                            <Button Content="+ Add Material"
                                    Command="{Binding BrowseMaterialCommand}"
                                    Padding="14,8"/>
                            <Button Content="+ Create New"
                                    Command="{Binding CreateMaterialCommand}"
                                    Padding="14,8"
                                    Classes="accent"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Models">
                    <Grid RowDefinitions="*,Auto">
                        <ScrollViewer Grid.Row="0"
                                      HorizontalScrollBarVisibility="Disabled"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding Models}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:PackAssetEntry">
                                        <Border Classes="content-tile">
                                            <Grid RowDefinitions="*,Auto,Auto">
                                                <PathIcon Grid.Row="0"
                                                          Data="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                                                          Width="36" Height="36"
                                                          Foreground="{StaticResource EditorTextSecondary}"
                                                          VerticalAlignment="Center"
                                                          HorizontalAlignment="Center"/>
                                                <TextBlock Grid.Row="1"
                                                           Text="{Binding Key}"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextAlignment="Center"
                                                           ToolTip.Tip="{Binding Key}"
                                                           Margin="0,8,0,0"/>
                                                <Button Grid.Row="2"
                                                        Content="Remove"
                                                        Padding="10,6"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,6,0,0"
                                                        Command="{Binding $parent[ItemsControl].DataContext.RemoveModelCommand}"
                                                        CommandParameter="{Binding}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    Spacing="10"
                                    Margin="12">
                            <Button Content="+ Add Model"
                                    Command="{Binding BrowseModelCommand}"
                                    Padding="14,8"
                                    Classes="accent"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Shaders">
                    <Grid RowDefinitions="*,Auto">
                        <ScrollViewer Grid.Row="0"
                                      HorizontalScrollBarVisibility="Disabled"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding Shaders}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:PackAssetEntry">
                                        <Border Classes="content-tile"
                                                DoubleTapped="OnAssetCardDoubleTapped"
                                                Tag="{Binding}">
                                            <Grid RowDefinitions="*,Auto,Auto">
                                                <ui:SymbolIcon Grid.Row="0"
                                                               Symbol="Code"
                                                               FontSize="{StaticResource IconSizeXL}"
                                                               Foreground="{StaticResource EditorTextSecondary}"
                                                               VerticalAlignment="Center"
                                                               HorizontalAlignment="Center"/>
                                                <TextBlock Grid.Row="1"
                                                           Text="{Binding Key}"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextAlignment="Center"
                                                           ToolTip.Tip="{Binding Key}"
                                                           Margin="0,8,0,0"/>
                                                <Button Grid.Row="2"
                                                        Content="Remove"
                                                        Padding="10,6"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,6,0,0"
                                                        Command="{Binding $parent[ItemsControl].DataContext.RemoveShaderCommand}"
                                                        CommandParameter="{Binding}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    Spacing="10"
                                    Margin="12">
                            <Button Content="+ Add Shader"
                                    Command="{Binding BrowseShaderCommand}"
                                    Padding="14,8"/>
                            <Button Content="+ Create New"
                                    Command="{Binding CreateShaderCommand}"
                                    Padding="14,8"
                                    Classes="accent"/>
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>

            <Border Grid.Row="2"
                    Background="{StaticResource EditorPanelSecondaryBackground}"
                    Padding="14,10"
                    IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="{StaticResource EditorTextMuted}"/>
            </Border>
        </Grid>

        <Border Grid.Column="1"
                IsVisible="{Binding !IsEditing}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="16">
                <ui:SymbolIcon Symbol="Folder"
                               FontSize="{StaticResource IconSizeHuge}"
                               Foreground="{StaticResource EditorTextMuted}"/>
                <TextBlock Text="Select a pack or create a new one"
                           Foreground="{StaticResource EditorTextMuted}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>

    <Border IsVisible="{Binding IsFileBrowserOpen}"
            Classes="dialog-overlay">
        <Border Background="{StaticResource EditorPanelBackground}"
                BorderBrush="{StaticResource EditorPanelBorder}"
                BorderThickness="1"
                Padding="20"
                Margin="40"
                MaxWidth="900"
                MaxHeight="650"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
            <Grid RowDefinitions="Auto,*,Auto">
                <TextBlock Grid.Row="0"
                           Text="{Binding FileBrowserTitle}"
                           Classes="subtitle"
                           Margin="0,0,0,16"/>
                <views:FileBrowserGrid Grid.Row="1"
                                       DataContext="{Binding FileBrowserViewModel}"/>
                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="10"
                            Margin="0,16,0,0">
                    <Button Content="Cancel"
                            Command="{Binding CloseFileBrowserCommand}"
                            Padding="18,10"/>
                </StackPanel>
            </Grid>
        </Border>
    </Border>

    <Border IsVisible="{Binding IsAssetEditorOpen}"
            Classes="dialog-overlay">
        <Border Background="{StaticResource EditorPanelBackground}"
                BorderBrush="{StaticResource EditorPanelBorder}"
                BorderThickness="1"
                Padding="24"
                Margin="60"
                MaxWidth="520"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
            <Grid RowDefinitions="Auto,*,Auto">
                <TextBlock Grid.Row="0"
                           Text="{Binding AssetEditorTitle}"
                           Classes="subtitle"
                           Margin="0,0,0,20"/>

                <StackPanel Grid.Row="1"
                            x:Name="MaterialEditorPanel"
                            Spacing="14">
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Name" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingAssetName}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Shader" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingAssetShader}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Albedo" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingAssetAlbedo}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Normal" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingAssetNormal}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Metallic" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingAssetMetallic}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Roughness" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingAssetRoughness}"/>
                    </Grid>
                </StackPanel>

                <StackPanel Grid.Row="1"
                            x:Name="ShaderEditorPanel"
                            Spacing="14">
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Name" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingShaderName}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Type" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingShaderType}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Vertex Path" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingShaderVertexPath}"/>
                    </Grid>
                    <Grid ColumnDefinitions="110,*">
                        <TextBlock Text="Pixel Path" VerticalAlignment="Center" Foreground="{StaticResource EditorTextSecondary}"/>
                        <TextBox Grid.Column="1" Text="{Binding EditingShaderPixelPath}"/>
                    </Grid>
                </StackPanel>

                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="10"
                            Margin="0,20,0,0">
                    <Button Content="Cancel"
                            Command="{Binding CloseAssetEditorCommand}"
                            Padding="18,10"/>
                    <Button Content="Save"
                            Command="{Binding SaveAssetEditorCommand}"
                            Padding="18,10"
                            Classes="accent"/>
                </StackPanel>
            </Grid>
        </Border>
    </Border>
    </Panel>
</UserControl>
