<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             x:Class="NiziKit.Editor.Views.SceneTreeView"
             x:DataType="vm:EditorViewModel"
             Focusable="True">

    <UserControl.Resources>
        <views:BoolToForegroundConverter x:Key="BoolToForegroundConverter"/>
    </UserControl.Resources>

    <Panel>
        <Grid RowDefinitions="*,Auto">
            <TreeView Grid.Row="0"
                      x:Name="SceneTree"
                      ItemsSource="{Binding RootObjects}"
                      SelectionMode="Single"
                      Background="Transparent"
                      Margin="0"
                      PointerPressed="OnTreeViewPointerPressed">
                <TreeView.ItemTemplate>
                    <TreeDataTemplate ItemsSource="{Binding Children}" x:DataType="vm:GameObjectViewModel">
                        <Border Padding="4,6"
                                Background="Transparent"
                                CornerRadius="2">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="{Binding TypeIconData}"
                                          Width="20" Height="20"
                                          Foreground="{Binding TypeIconColor}"
                                          VerticalAlignment="Center"
                                          Opacity="{Binding IsActive, Converter={x:Static vm:GameObjectViewModel.ActiveToOpacityConverter}}"/>
                                <TextBlock Text="{Binding Name}"
                                           VerticalAlignment="Center"
                                           Foreground="{Binding IsActive, Converter={StaticResource BoolToForegroundConverter}}"/>
                            </StackPanel>
                        </Border>
                    </TreeDataTemplate>
                </TreeView.ItemTemplate>
                <TreeView.Styles>
                    <Style Selector="TreeViewItem">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                        <Setter Property="Padding" Value="2"/>
                    </Style>
                    <Style Selector="TreeViewItem:selected /template/ Border#PART_LayoutRoot">
                        <Setter Property="Background" Value="{DynamicResource EditorSelected}"/>
                    </Style>
                    <Style Selector="TreeViewItem:pointerover /template/ Border#PART_LayoutRoot">
                        <Setter Property="Background" Value="{DynamicResource EditorHover}"/>
                    </Style>
                </TreeView.Styles>
            </TreeView>

            <Border Grid.Row="1"
                    x:Name="DeleteConfirmPanel"
                    IsVisible="False"
                    Classes="status-error"
                    Margin="0,8,0,0">
                <StackPanel Spacing="10">
                    <TextBlock x:Name="DeleteConfirmText"
                               Text="Delete this object?"
                               TextWrapping="Wrap"
                               Foreground="{StaticResource EditorError}"/>
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                        <Button Content="Cancel"
                                x:Name="CancelDeleteButton"
                                Padding="16,8"/>
                        <Button Content="Delete"
                                x:Name="ConfirmDeleteButton"
                                Classes="danger"
                                Padding="16,8"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <views:InlineContextMenu x:Name="InlineMenu"/>
    </Panel>
</UserControl>
