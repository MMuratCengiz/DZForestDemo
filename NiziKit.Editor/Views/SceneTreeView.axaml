<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             x:Class="NiziKit.Editor.Views.SceneTreeView"
             x:DataType="vm:EditorViewModel"
             Focusable="True">

    <UserControl.Resources>
        <views:BoolToForegroundConverter x:Key="BoolToForegroundConverter"/>
    </UserControl.Resources>

    <Panel>
        <Grid RowDefinitions="Auto,*,Auto">
            <Border Grid.Row="0"
                    x:Name="SceneRootNode"
                    Padding="6,8"
                    Margin="0,0,0,4"
                    Cursor="Hand">
                <Border.Styles>
                    <Style Selector="Border#SceneRootNode">
                        <Setter Property="Background" Value="Transparent"/>
                    </Style>
                    <Style Selector="Border#SceneRootNode.selected">
                        <Setter Property="Background" Value="{DynamicResource EditorSelected}"/>
                    </Style>
                    <Style Selector="Border#SceneRootNode:not(.selected):pointerover">
                        <Setter Property="Background" Value="{DynamicResource EditorHover}"/>
                    </Style>
                </Border.Styles>
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <PathIcon Data="M18,18H6V6H18M18,4H6A2,2 0 0,0 4,6V18A2,2 0 0,0 6,20H18A2,2 0 0,0 20,18V6C20,4.89 19.1,4 18,4Z"
                              Width="20" Height="20"
                              Foreground="{StaticResource EditorAccentBrush}"/>
                    <TextBlock Text="{Binding SceneDisplayName, FallbackValue='Scene'}"
                               VerticalAlignment="Center"
                               FontWeight="SemiBold"/>
                </StackPanel>
            </Border>
            <TreeView Grid.Row="1"
                      x:Name="SceneTree"
                      ItemsSource="{Binding RootObjects}"
                      SelectionMode="Single"
                      Background="Transparent"
                      Margin="0"
                      PointerPressed="OnTreeViewPointerPressed">
                <TreeView.ItemTemplate>
                    <TreeDataTemplate ItemsSource="{Binding Children}" x:DataType="vm:GameObjectViewModel">
                        <Border Padding="4,6"
                                Background="Transparent"
                                CornerRadius="2">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="{Binding TypeIconData}"
                                          Width="20" Height="20"
                                          Foreground="{Binding TypeIconColor}"
                                          VerticalAlignment="Center"
                                          Opacity="{Binding IsActive, Converter={x:Static vm:GameObjectViewModel.ActiveToOpacityConverter}}"/>
                                <TextBlock Text="{Binding Name}"
                                           VerticalAlignment="Center"
                                           Foreground="{Binding IsActive, Converter={StaticResource BoolToForegroundConverter}}"/>
                            </StackPanel>
                        </Border>
                    </TreeDataTemplate>
                </TreeView.ItemTemplate>
                <TreeView.Styles>
                    <Style Selector="TreeViewItem">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                        <Setter Property="Padding" Value="2"/>
                    </Style>
                    <Style Selector="TreeViewItem:selected /template/ Border#PART_LayoutRoot">
                        <Setter Property="Background" Value="{DynamicResource EditorSelected}"/>
                    </Style>
                    <Style Selector="TreeViewItem:pointerover /template/ Border#PART_LayoutRoot">
                        <Setter Property="Background" Value="{DynamicResource EditorHover}"/>
                    </Style>
                </TreeView.Styles>
            </TreeView>

            <Border Grid.Row="2"
                    x:Name="DeleteConfirmPanel"
                    IsVisible="False"
                    Classes="status-error"
                    Margin="0,8,0,0">
                <StackPanel Spacing="10">
                    <TextBlock x:Name="DeleteConfirmText"
                               Text="Delete this object?"
                               TextWrapping="Wrap"
                               Foreground="{StaticResource EditorError}"/>
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                        <Button Content="Cancel"
                                x:Name="CancelDeleteButton"
                                Padding="16,8"/>
                        <Button Content="Delete"
                                x:Name="ConfirmDeleteButton"
                                Classes="danger"
                                Padding="16,8"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <views:InlineContextMenu x:Name="InlineMenu"/>
    </Panel>
</UserControl>
