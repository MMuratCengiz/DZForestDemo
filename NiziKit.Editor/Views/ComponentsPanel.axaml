<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="NiziKit.Editor.Views.ComponentsPanel"
             x:DataType="vm:EditorViewModel">

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  Padding="0">
        <StackPanel>
            <StackPanel IsVisible="{Binding !HasSelection}"
                        HorizontalAlignment="Center"
                        Margin="0,60">
                <Border Background="{StaticResource EditorSurfaceRaised}"
                        Padding="32"
                        HorizontalAlignment="Center">
                    <StackPanel Spacing="16" HorizontalAlignment="Center">
                        <ui:SymbolIcon Symbol="People"
                                       FontSize="{StaticResource IconSizeXXL}"
                                       Foreground="{StaticResource EditorTextMuted}"
                                       HorizontalAlignment="Center"/>
                        <TextBlock Text="Select an object to edit"
                                   Foreground="{StaticResource EditorTextMuted}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </StackPanel>

            <StackPanel IsVisible="{Binding DataContext.HasSelection, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        DataContext="{Binding SelectedGameObject}">

                <Border Background="{StaticResource EditorSurfaceRaised}"
                        BorderBrush="{StaticResource EditorPanelBorder}"
                        BorderThickness="1"
                        Padding="14"
                        Margin="0,0,0,16">
                    <Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto">
                        <CheckBox Grid.Column="0"
                                  IsChecked="{Binding IsActive}"
                                  VerticalAlignment="Center"
                                  Margin="0,0,10,0"/>
                        <TextBlock Grid.Column="1"
                                   Text="Name"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource EditorTextSecondary}"
                                   Margin="0,0,12,0"/>
                        <TextBox Grid.Column="2"
                                 Text="{Binding Name}"
                                 VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <Border Background="{StaticResource EditorSurfaceRaised}"
                        BorderBrush="{StaticResource EditorPanelBorder}"
                        BorderThickness="1"
                        Padding="14"
                        Margin="0,0,0,16">
                    <StackPanel Spacing="14">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="Transform"
                                       Classes="subtitle"
                                       VerticalAlignment="Center"/>
                            <Border Grid.Column="1"
                                    Background="{StaticResource EditorAccentBrush}"
                                    Padding="8,4">
                                <ui:SymbolIcon Symbol="MapPin" FontSize="{StaticResource IconSizeSmall}" Foreground="#FFFFFF"/>
                            </Border>
                        </Grid>

                        <StackPanel Spacing="10">
                            <Grid ColumnDefinitions="60,*">
                                <TextBlock Text="Position"
                                           Foreground="{StaticResource EditorTextSecondary}"
                                           VerticalAlignment="Center"/>
                                <Grid Grid.Column="1" ColumnDefinitions="*,*,*">
                                    <views:DraggableValueEditor Grid.Column="0"
                                                                Label="X"
                                                                LabelColor="{DynamicResource AxisXBrush}"
                                                                Value="{Binding PositionX}"
                                                                DragSensitivity="0.05"
                                                                Margin="0,0,4,0"/>
                                    <views:DraggableValueEditor Grid.Column="1"
                                                                Label="Y"
                                                                LabelColor="{DynamicResource AxisYBrush}"
                                                                Value="{Binding PositionY}"
                                                                DragSensitivity="0.05"
                                                                Margin="0,0,4,0"/>
                                    <views:DraggableValueEditor Grid.Column="2"
                                                                Label="Z"
                                                                LabelColor="{DynamicResource AxisZBrush}"
                                                                Value="{Binding PositionZ}"
                                                                DragSensitivity="0.05"/>
                                </Grid>
                            </Grid>

                            <Grid ColumnDefinitions="60,*">
                                <TextBlock Text="Rotation"
                                           Foreground="{StaticResource EditorTextSecondary}"
                                           VerticalAlignment="Center"/>
                                <Grid Grid.Column="1" ColumnDefinitions="*,*,*">
                                    <views:DraggableValueEditor Grid.Column="0"
                                                                Label="X"
                                                                LabelColor="{DynamicResource AxisXBrush}"
                                                                Value="{Binding RotationX}"
                                                                DragSensitivity="0.5"
                                                                StringFormat="F1"
                                                                Margin="0,0,4,0"/>
                                    <views:DraggableValueEditor Grid.Column="1"
                                                                Label="Y"
                                                                LabelColor="{DynamicResource AxisYBrush}"
                                                                Value="{Binding RotationY}"
                                                                DragSensitivity="0.5"
                                                                StringFormat="F1"
                                                                Margin="0,0,4,0"/>
                                    <views:DraggableValueEditor Grid.Column="2"
                                                                Label="Z"
                                                                LabelColor="{DynamicResource AxisZBrush}"
                                                                Value="{Binding RotationZ}"
                                                                DragSensitivity="0.5"
                                                                StringFormat="F1"/>
                                </Grid>
                            </Grid>

                            <Grid ColumnDefinitions="60,*">
                                <TextBlock Text="Scale"
                                           Foreground="{StaticResource EditorTextSecondary}"
                                           VerticalAlignment="Center"/>
                                <Grid Grid.Column="1" ColumnDefinitions="*,*,*">
                                    <views:DraggableValueEditor Grid.Column="0"
                                                                Label="X"
                                                                LabelColor="{DynamicResource AxisXBrush}"
                                                                Value="{Binding ScaleX}"
                                                                DragSensitivity="0.01"
                                                                Margin="0,0,4,0"/>
                                    <views:DraggableValueEditor Grid.Column="1"
                                                                Label="Y"
                                                                LabelColor="{DynamicResource AxisYBrush}"
                                                                Value="{Binding ScaleY}"
                                                                DragSensitivity="0.01"
                                                                Margin="0,0,4,0"/>
                                    <views:DraggableValueEditor Grid.Column="2"
                                                                Label="Z"
                                                                LabelColor="{DynamicResource AxisZBrush}"
                                                                Value="{Binding ScaleZ}"
                                                                DragSensitivity="0.01"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                    <TextBlock Text="Components"
                               Classes="subtitle"
                               VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1"
                               Text="{Binding Components.Count, StringFormat='{}{0} items'}"
                               Foreground="{StaticResource EditorTextMuted}"
                               VerticalAlignment="Center"/>
                </Grid>

                <ItemsControl ItemsSource="{Binding Components}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:ComponentViewModel">
                            <Border Background="{StaticResource EditorSurfaceRaised}"
                                    BorderBrush="{StaticResource EditorPanelBorder}"
                                    BorderThickness="1"
                                    Margin="0,0,0,8"
                                    Padding="12">
                                <StackPanel Spacing="0">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <ToggleButton Grid.Column="0"
                                                      IsChecked="{Binding IsExpanded}"
                                                      Padding="6"
                                                      VerticalAlignment="Center"
                                                      Classes="ghost">
                                            <ToggleButton.Styles>
                                                <Style Selector="ToggleButton">
                                                    <Setter Property="Content">
                                                        <Template>
                                                            <PathIcon Data="M8,5.14V19.14L19,12.14L8,5.14Z"
                                                                      Width="12" Height="12"
                                                                      Foreground="{DynamicResource EditorTextSecondary}"/>
                                                        </Template>
                                                    </Setter>
                                                </Style>
                                                <Style Selector="ToggleButton:checked">
                                                    <Setter Property="Content">
                                                        <Template>
                                                            <PathIcon Data="M7,10L12,15L17,10H7Z"
                                                                      Width="12" Height="12"
                                                                      Foreground="{DynamicResource EditorTextPrimary}"/>
                                                        </Template>
                                                    </Setter>
                                                </Style>
                                            </ToggleButton.Styles>
                                        </ToggleButton>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding DisplayName}"
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center"
                                                   Margin="8,0,0,0"/>
                                        <Button Grid.Column="2"
                                                Padding="8,6"
                                                Command="{Binding RemoveCommand}"
                                                ToolTip.Tip="Remove Component"
                                                Classes="ghost">
                                            <ui:SymbolIcon Symbol="Delete"
                                                           Foreground="{StaticResource EditorError}"/>
                                        </Button>
                                    </Grid>
                                    <Border IsVisible="{Binding IsExpanded}"
                                            Margin="0,12,0,0"
                                            Padding="0">
                                        <views:ComponentEditor DataContext="{Binding}"/>
                                    </Border>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Button HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Padding="14,12"
                        Margin="0,8,0,0"
                        IsVisible="{Binding !IsAddingComponent}"
                        Command="{Binding ToggleAddComponentPanelCommand}"
                        Classes="accent">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <ui:SymbolIcon Symbol="Add" Foreground="#FFFFFF"/>
                        <TextBlock Text="Add Component" Foreground="#FFFFFF"/>
                    </StackPanel>
                </Button>

                <views:AddComponentPanel IsVisible="{Binding IsAddingComponent}"
                                         DataContext="{Binding}"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
