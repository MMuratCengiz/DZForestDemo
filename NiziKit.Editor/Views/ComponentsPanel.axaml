<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="NiziKit.Editor.Views.ComponentsPanel"
             x:DataType="vm:EditorViewModel">

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  Padding="8">
        <StackPanel>
            <StackPanel IsVisible="{Binding !HasSelection}"
                        HorizontalAlignment="Center"
                        Margin="0,40">
                <ui:SymbolIcon Symbol="People"
                               FontSize="48"
                               Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,12"/>
                <TextBlock Text="Select an object to edit"
                           Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <StackPanel IsVisible="{Binding DataContext.HasSelection, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        DataContext="{Binding SelectedGameObject}">

                <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                        CornerRadius="{DynamicResource ControlCornerRadius}"
                        Padding="12"
                        Margin="0,0,0,14">
                    <Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto">
                        <CheckBox Grid.Column="0"
                                  IsChecked="{Binding IsActive}"
                                  VerticalAlignment="Center"
                                  Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="1"
                                   Text="Name"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                        <TextBox Grid.Column="2"
                                 Text="{Binding Name}"
                                 VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <TextBlock Text="Transform"
                           Theme="{StaticResource BodyStrongTextBlockStyle}"
                           Margin="0,0,0,8"/>

                <TextBlock Text="Position" Margin="0,0,0,4"/>
                <Grid ColumnDefinitions="*,*,*" Margin="0,0,0,12">
                    <views:DraggableValueEditor Grid.Column="0"
                                                Label="X"
                                                LabelColor="{DynamicResource AxisXBrush}"
                                                Value="{Binding PositionX}"
                                                DragSensitivity="0.05"
                                                Margin="0,0,4,0"/>
                    <views:DraggableValueEditor Grid.Column="1"
                                                Label="Y"
                                                LabelColor="{DynamicResource AxisYBrush}"
                                                Value="{Binding PositionY}"
                                                DragSensitivity="0.05"
                                                Margin="0,0,4,0"/>
                    <views:DraggableValueEditor Grid.Column="2"
                                                Label="Z"
                                                LabelColor="{DynamicResource AxisZBrush}"
                                                Value="{Binding PositionZ}"
                                                DragSensitivity="0.05"/>
                </Grid>

                <TextBlock Text="Rotation" Margin="0,0,0,4"/>
                <Grid ColumnDefinitions="*,*,*" Margin="0,0,0,12">
                    <views:DraggableValueEditor Grid.Column="0"
                                                Label="X"
                                                LabelColor="{DynamicResource AxisXBrush}"
                                                Value="{Binding RotationX}"
                                                DragSensitivity="0.5"
                                                StringFormat="F1"
                                                Margin="0,0,4,0"/>
                    <views:DraggableValueEditor Grid.Column="1"
                                                Label="Y"
                                                LabelColor="{DynamicResource AxisYBrush}"
                                                Value="{Binding RotationY}"
                                                DragSensitivity="0.5"
                                                StringFormat="F1"
                                                Margin="0,0,4,0"/>
                    <views:DraggableValueEditor Grid.Column="2"
                                                Label="Z"
                                                LabelColor="{DynamicResource AxisZBrush}"
                                                Value="{Binding RotationZ}"
                                                DragSensitivity="0.5"
                                                StringFormat="F1"/>
                </Grid>

                <TextBlock Text="Scale" Margin="0,0,0,4"/>
                <Grid ColumnDefinitions="*,*,*" Margin="0,0,0,16">
                    <views:DraggableValueEditor Grid.Column="0"
                                                Label="X"
                                                LabelColor="{DynamicResource AxisXBrush}"
                                                Value="{Binding ScaleX}"
                                                DragSensitivity="0.01"
                                                Margin="0,0,4,0"/>
                    <views:DraggableValueEditor Grid.Column="1"
                                                Label="Y"
                                                LabelColor="{DynamicResource AxisYBrush}"
                                                Value="{Binding ScaleY}"
                                                DragSensitivity="0.01"
                                                Margin="0,0,4,0"/>
                    <views:DraggableValueEditor Grid.Column="2"
                                                Label="Z"
                                                LabelColor="{DynamicResource AxisZBrush}"
                                                Value="{Binding ScaleZ}"
                                                DragSensitivity="0.01"/>
                </Grid>

                <Border Height="1"
                        Background="{DynamicResource DividerStrokeColorDefaultBrush}"
                        Margin="0,6,0,14"/>
                <TextBlock Text="Components"
                           Theme="{StaticResource BodyStrongTextBlockStyle}"
                           Margin="0,0,0,8"/>

                <ItemsControl ItemsSource="{Binding Components}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:ComponentViewModel">
                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                    CornerRadius="{DynamicResource ControlCornerRadius}"
                                    Margin="0,0,0,8"
                                    Padding="10">
                                <StackPanel Spacing="0">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <ToggleButton Grid.Column="0"
                                                      IsChecked="{Binding IsExpanded}"
                                                      Padding="4"
                                                      VerticalAlignment="Center">
                                            <ToggleButton.Styles>
                                                <Style Selector="ToggleButton">
                                                    <Setter Property="Content">
                                                        <Template>
                                                            <PathIcon Data="M8,5.14V19.14L19,12.14L8,5.14Z"
                                                                      Width="12" Height="12"
                                                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                                        </Template>
                                                    </Setter>
                                                </Style>
                                                <Style Selector="ToggleButton:checked">
                                                    <Setter Property="Content">
                                                        <Template>
                                                            <PathIcon Data="M7,10L12,15L17,10H7Z"
                                                                      Width="12" Height="12"
                                                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                                        </Template>
                                                    </Setter>
                                                </Style>
                                            </ToggleButton.Styles>
                                        </ToggleButton>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding DisplayName}"
                                                   Theme="{StaticResource BodyStrongTextBlockStyle}"
                                                   VerticalAlignment="Center"
                                                   Margin="6,0,0,0"/>
                                        <Button Grid.Column="2"
                                                Padding="6,4"
                                                Command="{Binding RemoveCommand}"
                                                ToolTip.Tip="Remove Component">
                                            <ui:SymbolIcon Symbol="Delete"
                                                           Foreground="#E05555"/>
                                        </Button>
                                    </Grid>
                                    <Border IsVisible="{Binding IsExpanded}"
                                            Margin="0,10,0,0"
                                            Padding="0">
                                        <views:ComponentEditor DataContext="{Binding}"/>
                                    </Border>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Button HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Padding="12,10"
                        Margin="0,6,0,0"
                        IsVisible="{Binding !IsAddingComponent}"
                        Command="{Binding ToggleAddComponentPanelCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <ui:SymbolIcon Symbol="Add"
                                       Foreground="{DynamicResource AccentFillColorDefaultBrush}"/>
                        <TextBlock Text="Add Component"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </Button>

                <views:AddComponentPanel IsVisible="{Binding IsAddingComponent}"
                                         DataContext="{Binding}"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
