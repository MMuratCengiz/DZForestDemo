<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NiziKit.Editor.ViewModels"
             xmlns:views="using:NiziKit.Editor.Views"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="NiziKit.Editor.Views.ComponentsPanel"
             x:DataType="vm:EditorViewModel">

    <Panel>
        <views:SmoothScrollViewer x:Name="InspectorScroll"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="0,0,0,24">
                <views:SceneSettingsPanel IsVisible="{Binding !HasSelection}"
                                           DataContext="{Binding}"/>

                <StackPanel IsVisible="{Binding DataContext.HasSelection, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            DataContext="{Binding SelectedGameObject}">

                    <Border Classes="inspector-header">
                        <Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto">
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding IsActive}"
                                      VerticalAlignment="Center"
                                      Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1"
                                       Text="Name"
                                       VerticalAlignment="Center"
                                       Foreground="{StaticResource EditorTextSecondary}"
                                       Margin="0,0,10,0"/>
                            <TextBox Grid.Column="2"
                                     Text="{Binding Name}"
                                     VerticalAlignment="Center"/>
                        </Grid>
                    </Border>

                    <Border Classes="transform-section">
                        <StackPanel Spacing="12">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z"
                                          Width="{StaticResource IconSizeSmall}" Height="{StaticResource IconSizeSmall}"
                                          Foreground="{StaticResource EditorAccentBrush}"/>
                                <TextBlock Text="Transform"
                                           Classes="subtitle"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <Grid ColumnDefinitions="70,*" Margin="0,4,0,0">
                                <TextBlock Text="Position"
                                           Foreground="{StaticResource EditorTextSecondary}"
                                           VerticalAlignment="Center"/>
                                <Grid Grid.Column="1" ColumnDefinitions="*,4,*,4,*">
                                    <views:DraggableValueEditor Grid.Column="0"
                                                                Label="X"
                                                                LabelColor="{DynamicResource AxisXBrush}"
                                                                Value="{Binding PositionX}"
                                                                DragSensitivity="0.05"/>
                                    <views:DraggableValueEditor Grid.Column="2"
                                                                Label="Y"
                                                                LabelColor="{DynamicResource AxisYBrush}"
                                                                Value="{Binding PositionY}"
                                                                DragSensitivity="0.05"/>
                                    <views:DraggableValueEditor Grid.Column="4"
                                                                Label="Z"
                                                                LabelColor="{DynamicResource AxisZBrush}"
                                                                Value="{Binding PositionZ}"
                                                                DragSensitivity="0.05"/>
                                </Grid>
                            </Grid>

                            <Grid ColumnDefinitions="70,*">
                                <TextBlock Text="Rotation"
                                           Foreground="{StaticResource EditorTextSecondary}"
                                           VerticalAlignment="Center"/>
                                <Grid Grid.Column="1" ColumnDefinitions="*,4,*,4,*">
                                    <views:DraggableValueEditor Grid.Column="0"
                                                                Label="X"
                                                                LabelColor="{DynamicResource AxisXBrush}"
                                                                Value="{Binding RotationX}"
                                                                DragSensitivity="0.5"
                                                                StringFormat="F1"/>
                                    <views:DraggableValueEditor Grid.Column="2"
                                                                Label="Y"
                                                                LabelColor="{DynamicResource AxisYBrush}"
                                                                Value="{Binding RotationY}"
                                                                DragSensitivity="0.5"
                                                                StringFormat="F1"/>
                                    <views:DraggableValueEditor Grid.Column="4"
                                                                Label="Z"
                                                                LabelColor="{DynamicResource AxisZBrush}"
                                                                Value="{Binding RotationZ}"
                                                                DragSensitivity="0.5"
                                                                StringFormat="F1"/>
                                </Grid>
                            </Grid>

                            <Grid ColumnDefinitions="70,*">
                                <TextBlock Text="Scale"
                                           Foreground="{StaticResource EditorTextSecondary}"
                                           VerticalAlignment="Center"/>
                                <Grid Grid.Column="1" ColumnDefinitions="*,4,*,4,*">
                                    <views:DraggableValueEditor Grid.Column="0"
                                                                Label="X"
                                                                LabelColor="{DynamicResource AxisXBrush}"
                                                                Value="{Binding ScaleX}"
                                                                DragSensitivity="0.01"/>
                                    <views:DraggableValueEditor Grid.Column="2"
                                                                Label="Y"
                                                                LabelColor="{DynamicResource AxisYBrush}"
                                                                Value="{Binding ScaleY}"
                                                                DragSensitivity="0.01"/>
                                    <views:DraggableValueEditor Grid.Column="4"
                                                                Label="Z"
                                                                LabelColor="{DynamicResource AxisZBrush}"
                                                                Value="{Binding ScaleZ}"
                                                                DragSensitivity="0.01"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <Grid ColumnDefinitions="*,Auto" Margin="2,8,0,10">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <PathIcon Data="M3,3H9V7H3V3M15,10H21V14H15V10M3,17H9V21H3V17M13,3V7H11V3H13M13,10V12H11V10H13M13,14V16H11V14H13M13,17V19H11V17H13M13,21H11V19H13V21M15,3V7H17V3H15M21,3V7H19V3H21M19,10V12H17V10H19M21,14H19V12H21V14Z"
                                      Width="{StaticResource IconSizeSmall}" Height="{StaticResource IconSizeSmall}"
                                      Foreground="{StaticResource EditorTextSecondary}"/>
                            <TextBlock Text="Components"
                                       Classes="subtitle"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <Border Grid.Column="1"
                                Background="{StaticResource EditorPanelElevated}"
                                CornerRadius="12"
                                Padding="10,3">
                            <TextBlock Text="{Binding Components.Count}"
                                       Foreground="{StaticResource EditorTextSecondary}"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"
                                       MinWidth="16"
                                       TextAlignment="Center"/>
                        </Border>
                    </Grid>

                    <ItemsControl ItemsSource="{Binding Components}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:ComponentViewModel">
                                <Border Classes="component-card">
                                    <StackPanel>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Button Grid.Column="0"
                                                    Command="{Binding ToggleExpandedCommand}"
                                                    Classes="ghost"
                                                    HorizontalAlignment="Stretch"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="12,10"
                                                    CornerRadius="4,0,0,0">
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <PathIcon Width="{StaticResource IconSizeXS}" Height="{StaticResource IconSizeXS}"
                                                              VerticalAlignment="Center">
                                                        <PathIcon.Data>
                                                            <Binding Path="IsExpanded">
                                                                <Binding.Converter>
                                                                    <x:Static Member="vm:ComponentViewModel.ExpandIconConverter"/>
                                                                </Binding.Converter>
                                                            </Binding>
                                                        </PathIcon.Data>
                                                        <PathIcon.Foreground>
                                                            <Binding Path="IsExpanded">
                                                                <Binding.Converter>
                                                                    <x:Static Member="vm:ComponentViewModel.ExpandColorConverter"/>
                                                                </Binding.Converter>
                                                            </Binding>
                                                        </PathIcon.Foreground>
                                                    </PathIcon>
                                                    <TextBlock Text="{Binding DisplayName}"
                                                               FontWeight="SemiBold"
                                                               VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                            <Button Grid.Column="1"
                                                    Padding="8,6"
                                                    Margin="0,4,8,4"
                                                    Command="{Binding RemoveCommand}"
                                                    ToolTip.Tip="Remove Component"
                                                    Classes="ghost">
                                                <PathIcon Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
                                                          Width="{StaticResource IconSizeSmall}" Height="{StaticResource IconSizeSmall}"
                                                          Foreground="{StaticResource EditorError}"/>
                                            </Button>
                                        </Grid>
                                        <Border IsVisible="{Binding IsExpanded}"
                                                Classes="component-body"
                                                CornerRadius="0,0,4,4">
                                            <views:ComponentEditor DataContext="{Binding}"/>
                                        </Border>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Button HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Padding="14,12"
                            Margin="0,6,0,0"
                            IsVisible="{Binding !IsAddingComponent}"
                            Command="{Binding ToggleAddComponentPanelCommand}"
                            Classes="accent">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <ui:SymbolIcon Symbol="Add" FontSize="{StaticResource IconSizeSmall}" Foreground="#FFFFFF"/>
                            <TextBlock Text="Add Component" Foreground="#FFFFFF"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </StackPanel>
        </views:SmoothScrollViewer>

        <Border x:Name="AddComponentOverlay"
                IsVisible="{Binding SelectedGameObject.IsAddingComponent, FallbackValue=False}"
                Background="#D0000000"
                ZIndex="100">
            <Border Background="{StaticResource EditorPanelBackground}"
                    BorderBrush="{StaticResource EditorPanelBorder}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusLarge}"
                    VerticalAlignment="Stretch"
                    Margin="8,8,8,8"
                    Padding="0">
                <views:AddComponentPanel DataContext="{Binding SelectedGameObject}"/>
            </Border>
        </Border>
    </Panel>
</UserControl>
